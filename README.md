# JsonUI_custom_form_editor

![image](https://github.com/Satoyans/JsonUI_custom_form_pack/assets/90595639/fefd67cc-f63d-4dc7-94cf-c5b756ebef51)

[JsonUI_custom_form_editor](https://github.com/Satoyans/JsonUI_custom_form_editor)で作成したUIを表示するアドオンです。

`/scriptevent cf:form`を実行すると表示されます。

`BP/scripts/form_data.js`を書き換えることで更新できます(多分)。

自由に改変してもらって構いません

配布する際は[JsonUI_custom_form_editor](https://github.com/Satoyans/JsonUI_custom_form_editor)のリンクを乗せるようにしてください。

## 送信しているデータの構造

`[データの長さの長さ][データの長さ][データ1][データ2][データ3]`

- `データの長さの長さ`:`データの長さ`の文字数
- `データの長さ`:データ1~3の内、一番長いものの長さ
- `データ1`:`text`,`image`,`button`の内、表示したいエレメントだけ書く。`データの長さ`までの残りを`;`で埋める
- `データ2`:テキストとして表示する文字列。`データの長さ`までの残りを`;`で埋める
- `データ3`:`[データの長さの長さ][データの長さ][sizeX][sizeY][offsetX][offsetY]`

  - `データの長さの長さ`:`データの長さ`の文字数
  - `データの長さ`:`[sizeX][sizeY][offsetX][offsetY]`の内、一番長いものの長さ
  - `sizeX`:本来は要素のX*`sizeX`。このパックでは要素の大きさが1pxのためそのままピクセル。`データの長さ`までの残りを`0`で埋める
  - `sizeY`:同上。`データの長さ`までの残りを`0`で埋める
  - `offsetX`:パネルの左からのピクセル。`指定したい値-ボタンのインデックス-1`にする必要がある(gridで要素のXの1pxずつずれていくため)。`データの長さ`までの残りを`0`で埋める。マイナスの値の時は`-00010`のようにする
  - `offsetY`:パネルの上からのピクセル。`指定したい値-1`にする必要がある。`データの長さ`までの残りを`0`で埋める。マイナスの値の時は`-00010`のようにする

### 例

`218;;;textimagebutton;;;;;;;;;;;;要素14003000300099-101`の場合(1個目のボタンとする)

1. `[2][18][;;;textimagebutton][;;;;;;;;;;;;要素][14003000300099-101]`データごとに分ける
2. `[textimagebutton],[要素],[14003000300099-101]`それぞれから`;`を消す
3. データごとに意味を解釈する

   1. `[textimagebutton]`:text,image,button全ての要素を表示する
   2. `[要素]`:ラベルに表示
   3. `[14003000300099-101]`
      1. `[1][4][0030][0030][0099][-101]`データごとに分ける
      2. `[30],[30],[99],[-101]`JsonUIによって数値に変換される
      3. `[30],[30],[100],[-100]`offsetXは+index(0)+1した100に,offsetYは+1した-100にする

### 注意

- `#size_binding_x(y)`はproperty_bagを記述していても動いた。
- `#anchored_offset_value_x(y)`はproperty_bagを記述すると動かなかった。
- 数字はスライス(`'%.1s' * 0`等)できない。
- JsonUIは`()`ごとに値から型に変換する 例.`('0text')`は数字とみなされ`0`に変換される
- 日本語などはスライスする際変わった挙動をする
  - 文字のコードポイント?を`U+num`とすると、
  - `num < 128`ならば長さ1
  - `128 ≦ num < 2048`ならば長さ2
  - `2048 ≦ num < 65536`ならば長さ3
  - `65536 ≦ num`ならば長さ4
  - としてカウントされるっぽい(`num`はjsの`"A".codePointAt(0)`で取得できる)
- 上の制約がある為`U+127`以下かつJsonUIが正しく処理できる文字で足りない文字を埋める必要がある(`' '`だと先頭が数字の文字列の場合変換されてしまうため使えなかった)
